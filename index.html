from flask import Flask, request, jsonify
import openai
import requests

app = Flask(__name__)

# OpenAI API Key 설정 (환경 변수로 설정 권장)
openai.api_key = "YOUR_OPENAI_API_KEY"

@app.route("/generate-design", methods=["POST"])
def generate_design():
    data = request.json
    user_input = data.get("description", "")
    
    response = openai.ChatCompletion.create(
        model="gpt-4",
        messages=[
            {"role": "system", "content": "당신은 건축 설계 전문가입니다. 사용자의 요구 사항에 맞춰 설계 방향을 제안하세요."},
            {"role": "user", "content": user_input}
        ]
    )
    
    return jsonify({"design_suggestion": response["choices"][0]["message"]["content"]})

@app.route("/analyze-regulations", methods=["POST"])
def analyze_regulations():
    data = request.json
    location = data.get("location", "")
    
    # 예제: 건축 법규 API 호출 (실제 API 필요)
    response = requests.get(f"https://building-regulations-api.com/{location}")
    
    if response.status_code == 200:
        regulations = response.json()
        return jsonify({"regulations": regulations})
    else:
        return jsonify({"error": "법규 데이터를 가져올 수 없습니다."}), 400

@app.route("/generate-3d-model", methods=["POST"])
def generate_3d_model():
    data = request.json
    design_parameters = data.get("parameters", {})
    
    # 예제: 3D 모델 생성 API 호출 (실제 API 필요)
    model_response = requests.post("https://3d-model-generator.com/api", json=design_parameters)
    
    if model_response.status_code == 200:
        model_url = model_response.json().get("model_url", "")
        return jsonify({"model_url": model_url})
    else:
        return jsonify({"error": "3D 모델을 생성할 수 없습니다."}), 400

if __name__ == "__main__":
    app.run(debug=True)
