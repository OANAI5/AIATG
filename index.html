from flask import Flask, request, jsonify
import openai

app = Flask(__name__)

# OpenAI API Key 설정 (테스트용 - 실제 사용 시 환경 변수로 설정 권장)
openai.api_key = "YOUR_OPENAI_API_KEY"

@app.route("/generate-design", methods=["POST"])
def generate_design():
    data = request.json
    user_input = data.get("description", "")
    
    # AI 건축 설계 방향 제안
    response = openai.ChatCompletion.create(
        model="gpt-4",
        messages=[
            {"role": "system", "content": "당신은 건축 설계 전문가입니다. 사용자의 요구 사항에 맞춰 설계 방향을 제안하세요."},
            {"role": "user", "content": user_input}
        ]
    )
    
    return jsonify({"design_suggestion": response["choices"][0]["message"]["content"]})

@app.route("/analyze-regulations", methods=["POST"])
def analyze_regulations():
    data = request.json
    location = data.get("location", "")
    
    # 샘플 건축 법규 데이터
    regulations_data = {
        "서울": "건폐율 60%, 용적률 300% 이하, 주거지역 높이 제한 35m",
        "부산": "건폐율 50%, 용적률 250% 이하, 해안가 건축 규제 적용",
        "대구": "건폐율 55%, 용적률 270% 이하, 대로변 10m 이격 필요"
    }
    
    regulations = regulations_data.get(location, "해당 지역의 건축 법규 정보가 없습니다. 다른 지역을 입력해 주세요.")
    return jsonify({"location": location, "regulations": regulations})

@app.route("/generate-3d-model", methods=["POST"])
def generate_3d_model():
    data = request.json
    design_parameters = data.get("parameters", {})
    
    # 실제 API 없이 테스트용 응답 반환
    sample_model_url = "https://example.com/sample-3d-model.obj"
    return jsonify({"model_url": sample_model_url, "parameters": design_parameters})

if __name__ == "__main__":
    app.run(debug=True)
